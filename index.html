<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>สถานะและตารางยอดโดเนท</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Noto Sans Thai', sans-serif;
      color: #333;
      line-height: 1.6;
      background-image: 
        linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), 
        url('https://i.ibb.co/9HjR9LvX/IMG-7300.jpg');
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      min-height: 100vh;
      padding: 20px 10px;
    }

    .wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }

    /* Navigation Bar */
    .toc-bar {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      padding: 20px 10px;
      margin-bottom: 30px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .toc-bar button {
      font-family: 'Noto Sans Thai', sans-serif;
      font-weight: 600;
      font-size: 15px;
      padding: 12px 24px;
      border: none;
      border-radius: 15px;
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .toc-bar button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
    }

    .toc-bar button:active {
      transform: translateY(-1px);
    }

    .btn-view {
      background: linear-gradient(135deg, #FF7043, #FF8A65);
    }

    .btn-check {
      background: linear-gradient(135deg, #BA68C8, #CE93D8);
    }

    .btn-contact {
      background: linear-gradient(135deg, #42A5F5, #66BB6A);
    }

    /* Content Container */
    .content-container {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 25px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      padding: 30px;
      margin-bottom: 25px;
      backdrop-filter: blur(10px);
    }

    /* Flex Layout */
    .flex-layout {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Progress Section */
    .donation-section {
      text-align: center;
    }

    .progress-stats {
      display: flex;
      justify-content: space-around;
      margin-bottom: 25px;
      gap: 20px;
      flex-wrap: wrap;
    }

    .stat-block {
      flex: 1;
      min-width: 150px;
      padding: 15px;
      background: linear-gradient(135deg, #f0f4ff, #e8f0fe);
      border-radius: 15px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    }

    .stat-block:first-child {
      background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
    }

    .stat-block > div:first-child {
      font-size: 14px;
      font-weight: 500;
      color: #666;
      margin-bottom: 8px;
    }

    .stat-number {
      font-size: clamp(24px, 6vw, 42px);
      font-weight: 700;
      color: #286acd;
      display: block;
      margin-top: 5px;
    }

    .remaining-text {
      font-size: 18px;
      margin-bottom: 20px;
      font-weight: 500;
      padding: 10px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.5);
    }

    .remaining-red {
      color: #d32f2f;
      background: rgba(255, 235, 238, 0.8);
    }

    .remaining-green {
      color: #2e7d32;
      background: rgba(232, 245, 233, 0.8);
    }

    /* Progress Bar */
    .progress-container {
      position: relative;
      height: 30px;
      background: #e0e0e0;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 15px;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #286acd, #42a5f5, #66bb6a);
      transition: width 1.5s ease-out;
      border-radius: 20px;
      position: relative;
      box-shadow: 0 2px 10px rgba(40, 106, 205, 0.3);
    }

    .progress-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.3), 
        transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Countdown Styles */
    .countdown-status {
      text-align: center;
      padding: 30px 20px;
      background: linear-gradient(135deg, #ffebee, #fce4ec);
      border-radius: 20px;
      margin: 20px 0;
    }

    .countdown-closed {
      font-size: 36px;
      color: #d32f2f;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .countdown-thanks {
      font-size: 20px;
      color: #d32f2f;
    }

    #end-text {
      font-size: 14px;
      color: #03A9F4;
      margin-top: 15px;
      text-align: center;
      font-weight: 500;
    }

    /* Notice Box */
    .notice {
      background: linear-gradient(135deg, #e3f2fd, #e8f5e9);
      border: 2px solid #90caf9;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 25px;
      font-size: 15px;
      color: #444;
      line-height: 1.8;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    }

    .notice a {
      color: #1976d2;
      text-decoration: none;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      transition: border-color 0.3s;
    }

    .notice a:hover {
      border-bottom-color: #1976d2;
    }

    /* Table Styles */
    #donationTable {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: white;
      margin-top: 20px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
    }

    #donationTable th {
      background: linear-gradient(135deg, #4fc3f7, #29b6f6);
      color: white;
      padding: 15px 10px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    #donationTable td {
      padding: 12px 10px;
      text-align: center;
      border-bottom: 1px solid #f0f0f0;
      font-size: 14px;
    }

    #donationTable tbody tr {
      transition: all 0.3s ease;
    }

    #donationTable tbody tr:hover {
      background: #f8f9fa;
      transform: scale(1.01);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    #donationTable tbody tr:last-child td {
      border-bottom: none;
    }

    /* Table column widths */
    #donationTable th:nth-child(1),
    #donationTable td:nth-child(1) { width: 10%; }
    
    #donationTable th:nth-child(2),
    #donationTable td:nth-child(2) { width: 20%; }
    
    #donationTable th:nth-child(3),
    #donationTable td:nth-child(3) { width: 25%; }
    
    #donationTable th:nth-child(4),
    #donationTable td:nth-child(4) { width: 20%; }
    
    #donationTable th:nth-child(5),
    #donationTable td:nth-child(5) { width: 25%; }

    /* Call to Action */
    #call-to-action {
      text-align: center;
      color: #286acd;
      margin-top: 25px;
      font-size: 18px;
      font-weight: 600;
      padding: 15px;
      background: linear-gradient(135deg, #e3f2fd, #e8eaf6);
      border-radius: 15px;
      display: none;
    }

    /* Pagination */
    .pagination {
      margin-top: 30px;
      text-align: center;
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .pagination button {
      font-family: 'Noto Sans Thai', sans-serif;
      background: linear-gradient(135deg, #42a5f5, #66bb6a);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      font-size: 14px;
      min-width: 40px;
    }

    .pagination button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .pagination button.active {
      background: linear-gradient(135deg, #1976d2, #1565c0);
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(25, 118, 210, 0.4);
    }

    /* Image Gallery */
    .image-gallery {
      display: grid;
      grid-template-columns: 1fr;
      gap: 30px;
      max-width: 1000px;
      margin: 40px auto;
      padding: 0 15px;
    }

    .image-gallery img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s;
    }

    .image-gallery img:hover {
      transform: scale(1.02);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    /* Responsive Design */
    @media (min-width: 768px) {
      .flex-layout {
        flex-direction: row;
        align-items: start;
        gap: 30px;
      }

      .left-panel,
      .right-panel {
        flex: 1;
      }

      .image-gallery {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px 5px;
      }

      .toc-bar {
        gap: 8px;
        padding: 15px 8px;
      }

      .toc-bar button {
        font-size: 13px;
        padding: 10px 16px;
      }

      .content-container {
        padding: 20px 15px;
      }

      .stat-block {
        min-width: 120px;
        padding: 12px;
      }

      #donationTable th,
      #donationTable td {
        padding: 8px 5px;
        font-size: 12px;
      }

      .countdown-closed {
        font-size: 28px;
      }

      .countdown-thanks {
        font-size: 16px;
      }
    }

    /* Loading Animation */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    #loadingRow {
      animation: pulse 1.5s infinite;
      font-size: 16px;
      color: #666;
    }
  </style>
</head>
<body>

  <nav class="toc-bar">
    <button class="btn-view" onclick="window.open('https://forms.gle/oiVQnoVz1k5LsnrW7', '_blank')">
     ส่งสลิป
    </button>
    <button class="btn-check" onclick="window.open('https://x.com/NT1_Project_TH/status/1946568814612926668', '_blank')">
      เกี่ยวกับเรา
    </button>
    <button class="btn-contact" onclick="window.open('https://x.com/nt1_project_th?s=21&t=DghsX3sbncYIO7bkKK6z8A', '_blank')">
      ติดต่อเรา
    </button>
  </nav>

  <div class="wrapper">
    <div class="flex-layout">

      <!-- Progress + Countdown Panel -->
      <div class="left-panel">
        <div class="content-container">
          <div class="donation-section">
            <div class="progress-stats">
              <div class="stat-block">
                <div>💰 ได้รับแล้ว</div>
                <span class="stat-number" id="raised-amount">0</span>
                <div style="font-size: 14px; color: #666;">บาท</div>
              </div>
              <div class="stat-block">
                <div>🎯 เป้าหมาย</div>
                <span class="stat-number" id="goal-amount">40,000</span>
                <div style="font-size: 14px; color: #666;">บาท</div>
              </div>
            </div>

            <div class="remaining-text" id="remaining-text">
              กำลังโหลดข้อมูล...
            </div>

            <div class="progress-container">
              <div class="progress-bar-fill" id="progress-fill" style="width: 0%"></div>
            </div>

            <div id="countdown-section" class="countdown-status">
              <div class="countdown-closed">กำลังโหลด...</div>
            </div>

            <div id="end-text">สิ้นสุด 26 ต.ค. 2025 เวลา 23:59 น.</div>
          </div>
        </div>
      </div>

      <!-- Table + Notice Panel -->
      <div class="right-panel">
        <div class="content-container">
          <div class="notice">
            📢 <strong>แจ้งเตือน:</strong> อย่าลืม <a href="https://forms.gle/Rc1V4K1Qt5pubTAW9" target="_blank">ส่งสลิป</a> หลังโอนนะคะ<br>
            ⏱️ ระบบจะอัปเดตข้อมูลภายใน 5 นาทีหลังส่งสลิป<br>
            ❓ หากไม่พบข้อมูลหรือมีปัญหา แจ้งเราได้ที่ <a href="https://x.com/nt1_project_th?s=21&t=DghsX3sbncYIO7bkKK6z8A" target="_blank">@NexT1DEProjectTH</a>
          </div>

          <!-- Table -->
          <table id="donationTable">
            <thead>
              <tr>
                <th>#</th>
                <th>วันที่โอน</th>
                <th>นามแฝง</th>
                <th>ยอด (บาท)</th>
                <th>สถานะ</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="5" id="loadingRow" style="text-align:center; padding: 50px;">
                  ⏳ กำลังโหลดข้อมูล...
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Call to action -->
          <div id="call-to-action"></div>

          <!-- Pagination -->
          <div class="pagination" id="pagination"></div>
        </div>
      </div>
    </div>

    <!-- Image Gallery -->
    <!-- <div class="image-gallery">
      <img src="https://i.ibb.co/PGjVtd0m/1.png" alt="NexT1DE Project 1">
      <img src="https://i.ibb.co/wFrJzBK3/2.png" alt="NexT1DE Project 2">
      <img src="https://i.ibb.co/j9MqDpqv/3.png" alt="NexT1DE Project 3">
    </div> -->
  </div>

  <script>
    // Configuration
    const apiURL = "https://script.google.com/macros/s/AKfycbwmhX1tI180NqptU_GKHrpiWolfvFsXZfN9gjCO_tG0jWRYde3D34vDwFpzCqKBPBZ9Mw/exec";
    const goalAmount = 40000;
    const endDate = new Date("2025-11-26T23:59:59+07:00");

    let rowsPerPage = getRowsPerPage();
    let currentPage = 1;
    let allData = [];
    let isDonationClosed = false;

    function getRowsPerPage() {
      const width = window.innerWidth;
      if (width < 600) return 10;
      if (width <= 1024) return 15;
      return 20;
    }

    // Check if donation period has ended
    function checkDonationStatus() {
      const now = new Date();
      isDonationClosed = now > endDate;
      
      const countdownSection = document.getElementById("countdown-section");
      
      if (isDonationClosed) {
        countdownSection.innerHTML = `
          <div class="countdown-closed">🔒 ปิดโดเนทแล้ว</div>
          <div class="countdown-thanks">ขอบคุณทุกการสนับสนุนค่ะ ❤️</div>
        `;
      } else {
        // Calculate remaining time
        const distance = endDate - now;
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        
        countdownSection.innerHTML = `
          <div style="font-size: 20px; color: #1976d2; margin-bottom: 10px;">⏰ เหลือเวลาอีก</div>
          <div style="font-size: 32px; color: #d32f2f; font-weight: 700;">
            ${days} วัน ${hours} ชั่วโมง
          </div>
        `;
      }
    }

    // Fetch donation data
    fetch(apiURL)
      .then(response => response.json())
      .then(result => {
        const data = result.data || [];
        const total = parseFloat(result.total || "0");

        // Check donation status first
        checkDonationStatus();

        // Update progress display
        updateProgressDisplay(total);

        // Handle table data
        if (!Array.isArray(data) || data.length === 0) {
          showEmptyTable();
        } else {
          allData = data;
          renderTable();
          renderPagination();
        }
      })
      .catch(err => {
        console.error("Error fetching data:", err);
        document.getElementById("loadingRow").innerHTML = `
          <td colspan="5" style="color: red; text-align: center; padding: 50px;">
            ❌ เกิดข้อผิดพลาด: ไม่สามารถโหลดข้อมูลได้<br>
            <small>กรุณารีเฟรชหน้าใหม่</small>
          </td>
        `;
      });

    function updateProgressDisplay(total) {
      const remaining = goalAmount - total;
      const percent = Math.min((total / goalAmount) * 100, 100);

      document.getElementById("raised-amount").innerText = total.toLocaleString();
      document.getElementById("goal-amount").innerText = goalAmount.toLocaleString();
      
      // Check if donation is closed due to reaching goal or time limit
      if (isDonationClosed || total >= goalAmount) {
        document.getElementById("progress-fill").style.width = "100%";
        
        if (total >= goalAmount) {
          const over = total - goalAmount;
          const remainingText = document.getElementById("remaining-text");
          remainingText.className = "remaining-text remaining-green";
          remainingText.innerHTML = `
            🎉 <strong>ถึงเป้าหมายแล้ว!</strong> 
            (เกินเป้า ${over.toLocaleString()} บาท)
          `;
        } else {
          const remainingText = document.getElementById("remaining-text");
          remainingText.className = "remaining-text remaining-red";
          remainingText.innerHTML = `⏰ ปิดโดเนทแล้ว (ได้รับ ${percent.toFixed(1)}% ของเป้าหมาย)`;
        }
      } else {
        document.getElementById("progress-fill").style.width = percent + "%";
        
        const remainingText = document.getElementById("remaining-text");
        if (total === 0) {
          remainingText.className = "remaining-text remaining-red";
          remainingText.innerHTML = `🚀 ยังไม่มีการบริจาค - มาเป็นคนแรกกันเถอะ!`;
        } else {
          remainingText.className = "remaining-text remaining-red";
          remainingText.innerHTML = `
            📊 ความคืบหน้า ${percent.toFixed(1)}% 
            (เหลืออีก <strong>${remaining.toLocaleString()}</strong> บาท)
          `;
        }
      }
    }

    function showEmptyTable() {
      document.getElementById("donationTable").querySelector("tbody").innerHTML = `
        <tr>
          <td colspan="5" style="text-align:center; padding: 50px;">
            <div style="font-size: 20px; color: #666; margin-bottom: 10px;">
              🌊 ยังไม่มีการบริจาค
            </div>
            <div style="font-size: 16px; color: #999;">
              คุณอาจเป็นคนแรกที่จุดพลังให้ NexT1DE
            </div>
          </td>
        </tr>
      `;
      document.getElementById("call-to-action").style.display = "none";
    }

    function renderTable() {
      const tbody = document.getElementById("donationTable").querySelector("tbody");
      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = allData.slice(start, end);

      tbody.innerHTML = pageData.map((row, index) => {
        const displayIndex = start + index + 1;

        // Format status with better icons
        let statusText = row.status || "";
        let statusDisplay = "";
        if (statusText.toLowerCase().includes("pending")) {
          statusDisplay = '<span style="color: #ff9800;">⏳ รอตรวจสอบ</span>';
        } else if (statusText.toLowerCase().includes("approved")) {
          statusDisplay = '<span style="color: #4caf50;">✅ ตรวจสอบแล้ว</span>';
        } else {
          statusDisplay = '<span style="color: #666;">📝 ' + statusText + '</span>';
        }

        // Format date
        const dateDisplay = row.transfer_datetime && row.transfer_datetime.trim() !== '' 
          ? row.transfer_datetime 
          : '<span style="color: #999;">-</span>';

        // Format name
        const nameDisplay = row.name && row.name.trim() !== '' 
          ? row.name 
          : '<span style="color: #999;">[ไม่ระบุชื่อ]</span>';

        // Format amount
        const amountDisplay = parseFloat(row.amount || 0).toLocaleString();

        return `
          <tr>
            <td><strong>${displayIndex}</strong></td>
            <td>${dateDisplay}</td>
            <td>${nameDisplay}</td>
            <td style="text-align:right; font-weight: 600; color: #1976d2;">
              ${amountDisplay}
            </td>
            <td>${statusDisplay}</td>
          </tr>
        `;
      }).join("");

      // Show call to action
      const callToAction = document.getElementById("call-to-action");
      callToAction.style.display = "block";
      callToAction.innerHTML = `
        🌊 ขอบคุณที่อยู่เคียงข้าง NexT1DE ทุกก้าว 
        <span style="font-size: 14px; display: block; margin-top: 5px; font-weight: 400;">
          Together We Rise 💙
        </span>
      `;
    }

    function renderPagination() {
      const pageCount = Math.ceil(allData.length / rowsPerPage);
      const pagination = document.getElementById("pagination");
      
      if (pageCount <= 1) {
        pagination.innerHTML = "";
        return;
      }

      pagination.innerHTML = "";

      // Add Previous button
      if (currentPage > 1) {
        const prevBtn = document.createElement("button");
        prevBtn.innerHTML = "‹";
        prevBtn.addEventListener("click", () => {
          currentPage--;
          renderTable();
          renderPagination();
          scrollToTable();
        });
        pagination.appendChild(prevBtn);
      }

      // Page numbers
      let startPage = Math.max(1, currentPage - 2);
      let endPage = Math.min(pageCount, startPage + 4);
      
      if (endPage - startPage < 4) {
        startPage = Math.max(1, endPage - 4);
      }

      for (let i = startPage; i <= endPage; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        if (i === currentPage) btn.classList.add("active");
        btn.addEventListener("click", () => {
          currentPage = i;
          renderTable();
          renderPagination();
          scrollToTable();
        });
        pagination.appendChild(btn);
      }

      // Add Next button
      if (currentPage < pageCount) {
        const nextBtn = document.createElement("button");
        nextBtn.innerHTML = "›";
        nextBtn.addEventListener("click", () => {
          currentPage++;
          renderTable();
          renderPagination();
          scrollToTable();
        });
        pagination.appendChild(nextBtn);
      }
    }

    function scrollToTable() {
      document.getElementById("donationTable").scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start' 
      });
    }

    // Handle window resize
    window.addEventListener("resize", () => {
      const newRows = getRowsPerPage();
      if (newRows !== rowsPerPage) {
        rowsPerPage = newRows;
        currentPage = 1;
        if (allData.length > 0) {
          renderTable();
          renderPagination();
        }
      }
    });

    // Auto refresh every 5 minutes
    setInterval(() => {
      location.reload();
    }, 5 * 60 * 1000);

    // Initial countdown check
    checkDonationStatus();
    
    // Update countdown every hour
    setInterval(checkDonationStatus, 60 * 60 * 1000);
  </script>
</body>
</html>
